<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Sulifa 1v1 Bet Rooms</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

<div class="w-full max-w-md bg-gray-800 rounded-xl p-6 shadow-xl">

  <h1 class="text-2xl font-bold text-center mb-4">ü™®üìÑ‚úÇÔ∏è –°—É–ª–∏—Ñ–∞ 1v1</h1>

  <!-- PLAYER INFO -->
  <div class="text-center mb-4">
    <div>ID: <span id="tgId" class="font-mono text-xs break-all"></span></div>
    <div class="mt-2 text-lg">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> üí∞</div>
  </div>

  <!-- BET ROOMS -->
  <div id="betPanel" class="mb-4">
    <div class="text-center mb-2 font-semibold">–°—Ç–∞–≤–∫–∞ –±”©–ª–º–µ—Å—ñ–Ω —Ç–∞“£–¥–∞</div>
    <div class="grid grid-cols-4 gap-2">
      <button onclick="joinRoom(500)" class="bet-btn bg-gray-700 p-2 rounded">500</button>
      <button onclick="joinRoom(1000)" class="bet-btn bg-gray-700 p-2 rounded">1000</button>
      <button onclick="joinRoom(1500)" class="bet-btn bg-gray-700 p-2 rounded">1500</button>
      <button onclick="joinRoom(2000)" class="bet-btn bg-gray-700 p-2 rounded">2000</button>
    </div>
  </div>

  <!-- STATUS -->
  <div id="status" class="text-center text-yellow-400 mb-4">–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É...</div>

  <!-- GAME BUTTONS -->
  <div id="gamePanel" class="hidden grid grid-cols-3 gap-3 mb-4">
    <button onclick="sendChoice('rock')" class="bg-blue-600 p-3 rounded">ü™®</button>
    <button onclick="sendChoice('paper')" class="bg-green-600 p-3 rounded">üìÑ</button>
    <button onclick="sendChoice('scissors')" class="bg-red-600 p-3 rounded">‚úÇÔ∏è</button>
  </div>

  <!-- RESULT -->
  <div id="result" class="hidden text-center text-lg font-semibold"></div>

  <!-- RESTART -->
  <button id="restart" onclick="resetGame()" class="hidden mt-4 w-full bg-purple-600 p-2 rounded">
    üîÅ “ö–∞–π—Ç–∞ –æ–π–Ω–∞—É
  </button>

</div>

<script>
const SERVER = "https://sulifaonlinerender.onrender.com";
const tg = window.Telegram.WebApp;
tg.expand();
const tgId = tg.initDataUnsafe?.user?.id?.toString();
if (!tgId) alert("Telegram ID —Ç–∞–±—ã–ª–º–∞–¥—ã");

let socket, myBalance = 0, selectedBet = null;

document.getElementById("tgId").innerText = tgId;

fetch(`${SERVER}/player`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ tgId })
}).then(r => r.json())
  .then(p => {
    myBalance = p.balance;
    updateBalance();
    connectSocket();
  });

function connectSocket() {
  socket = io(SERVER);

  socket.on("waiting", () => setStatus("‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ..."));
  socket.on("game_start", () => {
    document.getElementById("betPanel").classList.add("hidden");
    setStatus("üéÆ –¢–∞“£–¥–∞!");
    showGame();
  });

  socket.on("game_result", data => {
    hideGame();
    let text = `–°—Ç–∞–≤–∫–∞: ${data.bet} üí∞<br>–°–µ–Ω: ${icon(data.p1)} | “ö–∞—Ä—Å—ã–ª–∞—Å: ${icon(data.p2)}<br>`;
    if (data.winner === "draw") text += "ü§ù –¢–µ“£!";
    else if (data.winner === tgId) { text += "üèÜ –°–µ–Ω –∂–µ“£–¥—ñ“£!"; myBalance += data.bet; }
    else { text += "‚ùå –°–µ–Ω –∂–µ“£—ñ–ª–¥—ñ“£"; myBalance -= data.bet; }
    updateBalance();
    showResult(text);
  });

  socket.on("error_msg", msg => { alert(msg); resetGame(); });
}

function joinRoom(bet) {
  if (myBalance < bet) return alert("–ë–∞–ª–∞–Ω—Å –∂–µ—Ç–∫—ñ–ª—ñ–∫—Å—ñ–∑");
  selectedBet = bet;
  document.querySelectorAll(".bet-btn").forEach(b => b.classList.remove("bg-green-600"));
  event.target.classList.add("bg-green-600");
  setStatus("–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É...");
  socket.emit("join_game", { tgId, bet });
}

function sendChoice(choice) { hideGame(); setStatus("‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å —Ç–∞“£–¥–∞—É–¥–∞..."); socket.emit("choice", choice); }
function resetGame() { selectedBet = null; document.getElementById("betPanel").classList.remove("hidden"); document.getElementById("result").classList.add("hidden"); document.getElementById("restart").classList.add("hidden"); setStatus("–°—Ç–∞–≤–∫–∞ –±”©–ª–º–µ—Å—ñ–Ω —Ç–∞“£–¥–∞"); }
function updateBalance() { document.getElementById("balance").innerText = myBalance; }
function setStatus(t) { document.getElementById("status").innerText = t; }
function showGame() { document.getElementById("gamePanel").classList.remove("hidden"); }
function hideGame() { document.getElementById("gamePanel").classList.add("hidden"); }
function showResult(text) { const r = document.getElementById("result"); r.innerHTML = text; r.classList.remove("hidden"); document.getElementById("restart").classList.remove("hidden"); }
function icon(v) { return v === "rock" ? "ü™®" : v === "paper" ? "üìÑ" : "‚úÇÔ∏è"; }
</script>

</body>
</html>
