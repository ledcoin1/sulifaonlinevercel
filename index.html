<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Sulifa Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-600 to-purple-700 min-h-screen text-white flex items-center justify-center">

<div class="bg-white text-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md">

  <h1 class="text-2xl font-bold mb-4 text-center">üéÆ Sulifa</h1>

  <div class="mb-3">
    <p class="text-sm text-gray-500">Telegram ID:</p>
    <p id="tgId" class="font-mono text-sm break-all">...</p>
  </div>

  <div class="mb-4">
    <p class="text-sm text-gray-500">–ë–∞–ª–∞–Ω—Å:</p>
    <p id="balance" class="text-3xl font-bold text-green-600">0</p>
  </div>

  <button onclick="reloadBalance()"
    class="w-full bg-indigo-600 text-white py-2 rounded-xl hover:bg-indigo-700 transition">
    üîÑ –ñ–∞“£–∞—Ä—Ç—É
  </button>

</div>

<script>
const SERVER = "https://sulifaonlinerender.onrender.com";

const tg = window.Telegram.WebApp;
tg.ready();

// ‚ùó Telegram Mini App —ñ—à—ñ–Ω–¥–µ “ì–∞–Ω–∞ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ
if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
  document.body.innerHTML = "<h1 class='text-white text-center mt-20'>‚ùå Telegram Mini App –µ–º–µ—Å</h1>";
  throw new Error("Not Telegram Mini App");
}

const user = tg.initDataUnsafe.user;
const tgId = String(user.id);

document.getElementById("tgId").innerText = tgId;

// –°–µ—Ä–≤–µ—Ä–≥–µ —Ç—ñ—Ä–∫–µ–ª—É
async function loadPlayer() {
  const res = await fetch(`${SERVER}/player`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ tgId })
  });

  const data = await res.json();
  document.getElementById("balance").innerText = data.balance;
}

function reloadBalance() {
  loadPlayer();
}

loadPlayer();
</script>

</body>
</html>
